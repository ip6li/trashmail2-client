!function(){"use strict";const url=$(location).attr("href"),domainRegex="^([a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9].){1,2}[a-zA-Z]{2,}$",nameRegex="^[a-zA-Z0-9._+-]{3,64}$",undef="undefined";let config=undef;function setSubmitState(state){$("#submit").prop("disabled",!state)}function validateDomain(domain){if(domain.length>64)return!1;const re=new RegExp(domainRegex);return domain.match(re)}function validateName(name){if(name.length>64||name.length<3)return!1;const re=new RegExp(nameRegex);return name.match(re)}function setDeleteIcons(){$("#mails").find("img").collect("id").forEach(function(id){$("#"+id).on("click",{uid:id},function(event){var encryptedUid;encryptedUid=event.data.uid,$("#dialogDelete").dialog({dialogClass:"no-close",buttons:[{text:"LÃ¶schen",click:function(){var what;what=encryptedUid,$.ajax({method:"POST",url:url,data:{do:"delete",delete:what}}).done(function(json){const msg=JSON.parse(json);"succeeded"===msg.res&&function(msg){$("#mail_"+msg.uid).hide()}(msg)}),$(this).dialog("close")}},{text:"Abbruch",click:function(){$(this).dialog("close")}}]})})})}function requestQrCode(name,domain){config.qrcode&&$.ajax({method:"POST",url:url,data:{do:"qrcode",name:name,domain:domain}}).done(function(json){const img="<img src='"+JSON.parse(json).qrcode+"' />";$("#qrcode").empty().append(img)})}function setMailForState(state){const divrcpt=$("#divrcpt"),divrcpt_label=$("#mails_for_label");state?(divrcpt.show(),divrcpt_label.show()):(divrcpt.hide(),divrcpt_label.hide())}function updateDivRcpt(data){$("#divrcpt").empty().append(data),setMailForState(!0)}$.fn.collect=function(fn){const values=[];if("string"==typeof fn){const prop=fn;fn=function(){return this.attr(prop)}}return $(this).each(function(){const val=fn.call($(this));values.push(val)}),values};const submitButton=$("#submit"),impressumButton=$("#b_impressum"),nameInput=$("#name"),domainSelect=$("#domain"),mailAddress=$("#mailaddress"),impress=$("#impressum"),dialogDelete=$("#dialogDelete"),noscript=$("#noscript"),main=$("#main");function updateMailAddress(){const name=nameInput.val(),domain=domainSelect.val();if(typeof name!==undef&&domain!==undef&&""!==name&&""!==domain){if(validateName(name)&&validateDomain(domain)){const emailAddress=name+"@"+domain;mailAddress.empty().append(emailAddress),requestQrCode(name,domain)}}else mailAddress.empty(),$("#qrcode").empty()}$(document).ready(function(){setMailForState(!1),$.when(function(){const dfd=$.Deferred();return $.ajax({method:"POST",url:url,data:{do:"config"}}).done(function(json){config=JSON.parse(json),dfd.resolve()}),dfd.promise()}()).then(function(){submitButton.on("click",function(){const data={};data.name=nameInput.val(),data.domain=domainSelect.val(),function(data){setSubmitState(!1),data.do="getmails",$.ajax({method:"POST",url:url,data:data}).done(function(mails){const divMails=$("#mails");divMails.empty(),validateName(data.name)&&validateDomain(data.domain)&&updateDivRcpt(data.name+"@"+data.domain),mails.length>0?(divMails.append(Base64.decode(mails)),setDeleteIcons()):divMails.append("<span class='nomails'>"+config.text.nomails+"</span>"),setSubmitState(!0)})}(data)}),impressumButton.on("click",function(){$("#impressum").dialog({dialogClass:"no-close",buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})}),$(this).keypress(function(event){10!==event.keyCode&&13!==event.keyCode||event.preventDefault()}),nameInput.keyup(function(event){10!==event.keyCode&&13!==event.keyCode||submitButton.click(),updateMailAddress()}),domainSelect.change(function(){updateMailAddress()});let urlParams={};if(window.onpopstate=function(){const pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},query=window.location.search.substring(1);let match=[];do{null!==(match=search.exec(query))&&(urlParams[decode(match[1])]=decode(match[2]))}while(null!==match);updateMailAddress()}(),void 0!==urlParams.domain&&void 0!==urlParams.name&&validateName(urlParams.name)&&validateDomain(urlParams.domain)){nameInput.val(urlParams.name),domainSelect.val(urlParams.domain);const rfc822=nameInput.val()+"@"+domainSelect.val();updateDivRcpt(rfc822),requestQrCode(urlParams.name,urlParams.domain)}const name=nameInput.val(),domain=domainSelect.val();typeof name!==undef&&typeof domain!==undef&&""!==name&&""!==domain&&mailAddress.empty().append(nameInput.val()+"@"+domainSelect.val()),impress.empty().append(config.text.impress),dialogDelete.empty().append(config.text.dialogDelete),noscript.hide(),main.show(),setSubmitState(!0)})})}();